<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DeFi Lending Benchmark</title>
  <style>
    :root { --bg:transparent; --card:#1a1d22; --muted:#9aa4b2; --fg:#e8eef7; --down:#ec5c5c; --up:#3fb87f; --accent:#2e323a; }
    *{box-sizing:border-box}
    body{margin:0;background:transparent;font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;color:var(--fg);}
    .card{max-width:760px;margin:24px auto;background:var(--card);border:1px solid #22262e;border-radius:0;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    header{display:flex;align-items:center;gap:14px;margin-bottom:8px}
    header img{width:42px;height:42px}
    header h1{font-size:26px;margin:0;font-weight:700;letter-spacing:.5px}
    .section-title{font-size:18px;margin:14px 0 8px; font-weight:800}
    .hr{height:1px;background:#282c35;margin:10px 0}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th, td{padding:12px;text-align:left;border-bottom:1px solid #282c35;vertical-align:top;}
    th{font-weight:700;color:var(--muted)}
    td{font-weight:600;}
    .protocol{display:flex;align-items:center;gap:8px}
    .protocol img{width:24px;height:24px;border-radius:0}
    .foot{margin-top:10px;color:#7d8897;font-size:12px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    a{color:#9cc9ff;text-decoration:none}
    .notes { white-space: normal; overflow-wrap: anywhere; word-break: break-all; hyphens: auto; }
  </style>
</head>
<body>
  <div class="card" id="widget" data-vs="usd">
    <header>
      <h1>DeFi Lending Competitors Benchmark</h1>
    </header>
    <div class="section-title">Key Metrics</div>
    <div class="hr"></div>
    <table>
      <thead>
        <tr>
          <th>Protocol</th>
          <th>Market Cap</th>
          <th>FDV</th>
          <th>Volume 24h</th>
          <th>TVL</th>
          <th>Niche</th>
        </tr>
      </thead>
      <tbody id="table-body">
        <!-- Rows will be populated here -->
      </tbody>
    </table>
    <div class="foot">
      <div>Data from CoinGecko (MCAP, FDV, VOL) and DefiLlama (TVL).</div>
    </div>
  </div>
  <script>
    async function fetchJSON(url){ const res = await fetch(url, {headers:{'accept':'application/json'}}); if(!res.ok) throw new Error('HTTP '+res.status); return res.json(); }
    function fmtUSD(n){ if(n===null||n===undefined) return '—'; const abs=Math.abs(n); if(abs>=1e12) return '$'+(n/1e12).toFixed(2)+'T'; if(abs>=1e9) return '$'+(n/1e9).toFixed(2)+'B'; if(abs>=1e6) return '$'+(n/1e6).toFixed(2)+'M'; if(abs>=1e3) return '$'+(n/1e3).toFixed(2)+'K'; return '$'+n.toLocaleString(undefined,{maximumFractionDigits:2}); }
    (async function init(){
      const root = document.getElementById('widget');
      const vs = root.dataset.vs || 'usd';
      const coins = [
        { id: 'aave', name: 'AAVE', slug: 'aave', notes: 'General-purpose, non-custodial lending & borrowing protocol. Users deposit assets to earn yield, borrow against collateral.' },
        { id: 'morpho', name: 'MORPHO', slug: 'morpho', notes: 'Enhances existing lending markets like Aave and Compound by implementing a peer-to-peer matching mechanism.' },
        { id: 'compound-governance-token', name: 'COMPOUND', slug: 'compound-finance', notes: 'Allows users to supply assets to liquidity pools and earn interest or borrow assets by providing collateral.' },
        { id: 'euler', name: 'EULER', slug: 'euler', notes: 'Offers a wide range of assets for lending and borrowing, with a focus on capital efficiency and risk management.' }
      ];
      try {
        // Fetch market data for all coins
        const ids = coins.map(c => c.id).join(',');
        const marketsURL = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=${vs}&ids=${encodeURIComponent(ids)}&sparkline=false&price_change_percentage=24h`;
        const marketData = await fetchJSON(marketsURL);
        const marketMap = new Map(marketData.map(coin => [coin.id, coin]));

        // Fetch TVL for each protocol
        const tvlPromises = coins.map(async (c) => {
          try {
            const tvl = await fetchJSON(`https://api.llama.fi/tvl/${c.slug}`);
            return { ...c, tvl };
          } catch {
            return { ...c, tvl: null };
          }
        });
        const coinsWithTvl = await Promise.all(tvlPromises);

        // Populate table
        const tbody = document.getElementById('table-body');
        coinsWithTvl.forEach(coin => {
          const market = marketMap.get(coin.id);
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="protocol"><img src="${market?.image || ''}" alt="${coin.name} logo" /><span>${coin.name}</span></td>
            <td>${fmtUSD(market?.market_cap)}</td>
            <td>${fmtUSD(market?.fully_diluted_valuation)}</td>
            <td>${fmtUSD(market?.total_volume)}</td>
            <td>${fmtUSD(coin.tvl)}</td>
            <td class="notes">${coin.notes}</td>
          `;
          tbody.appendChild(row);
        });
      } catch(err){
        console.error(err);
        // Fill with placeholders on error
        const tbody = document.getElementById('table-body');
        coins.forEach(coin => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="protocol"><img src="" alt="${coin.name} logo" /><span>${coin.name}</span></td>
            <td>—</td>
            <td>—</td>
            <td>—</td>
            <td>—</td>
            <td class="notes">${coin.notes}</td>
          `;
          tbody.appendChild(row);
        });
      }
    })();
  </script>
</body>
</html>
